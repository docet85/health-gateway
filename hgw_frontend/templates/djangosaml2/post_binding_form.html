{% extends 'admin/base.html' %}
{% block title %}
    TS/CNS Login Authentication Page
{% endblock %}
{% block extrahead %}
<script type="text/javascript">
    cancel_redirect = function () {
        {#const url = "{{ params.RelayState }}".split('?')[0];#}
        const qs = "{{ params.RelayState }}".split('?')[1];
        const data = {};
        for (let k of qs.split("&amp;")) {
            let kk = k.split("=");
            data[kk[0]] = kk[1];
        }
        // TODO here we might also come from the consent_confirm (but this is very rare)
        window.location = "/v1/flow_requests/cancel/?confirm_id=" + data["confirm_id"] +
            "&callback_url=" + data["callback_url"];
    };
</script>
{% endblock %}
{% block content %}
<div class="">
    <h2 align="center">TS/CNS Login Authentication Page</h2>
    <b>TS/CNS Identification</b>
<p>
            Ensure you have your TS/CNS reader properly connected and with the required rivers installed.
            Insert your TS/CNS card into the reader, then click on the TS/CNS Login button. You will be asked
            to enter your PIN and to confirm certificate selection.
</p>
    <form method="post" action="{{ target_url }}" name="SSO_Login">
        {% for key, value in params.items %}
            {% if key == "SAMLRequest" %}
                <input type="hidden" name="{{ key|safe }}" value="{{ value.decode|safe }}"/>
            {% else %}
                <input type="hidden" name="{{ key|safe }}" value="{{ value|safe }}"/>
            {% endif %}
        {% endfor %}
        <input type="submit" value="Log in"/>
    </form>
    <button class="button" onclick="cancel_redirect()">
        Back
    </button>
</div>
{% endblock %}
